!function(e,n){for(var r in n)e[r]=n[r]}(exports,function(e){var n={};function r(o){if(n[o])return n[o].exports;var t=n[o]={i:o,l:!1,exports:{}};return e[o].call(t.exports,t,t.exports,r),t.l=!0,t.exports}return r.m=e,r.c=n,r.d=function(e,n,o){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)r.d(o,t,function(n){return e[n]}.bind(null,t));return o},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=4)}([function(e,n){e.exports=require("json-serverless-lib")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("serverless-http")},function(e,n){e.exports=require("fs")},function(e,n,r){"use strict";r.r(n),r.d(n,"handler",(function(){return S}));var o=r(1),t=r.n(o),s=r(2),i=r.n(s),c=r(0),a=r(3),u=r.n(a);const l=r(5),p=t()();console.log("process.env.region: "+process.env.region),console.log("process.env.cognitoUserPoolId: "+JSON.stringify(process.env.COGNITO_USER_POOL_ID));const f=new l({region:process.env.region,cognitoUserPoolId:process.env.COGNITO_USER_POOL_ID,tokenUse:"id",tokenExpiration:36e5});p.use((e,n,r)=>{if(n.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),n.header("Access-Control-Allow-Origin","*"),n.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, Authorization"),n.header("Access-Control-Allow-Credentials","true"),n.header("Cache-Control","private, no-cache, no-store, must-revalidate"),console.log(e.url),"OPTIONS"!==e.method&&e.url.startsWith("/api")){let o=e.headers.authorization;if(!o)return n.status(401).send("Access Token missing from header");f.validate(o,(function(e,o){if(e)return n.status(401).send(e);r()}))}else r()});const d=i()(p),g=new c.AppConfig,O=JSON.parse(u.a.readFileSync("./config/appconfig.json","UTF-8")),v=c.AppConfig.merge(g,O),w=new c.CloudEnvironment,y=new c.Swagger(p,new c.SwaggerConfig(v.readOnly,v.enableApiKeyAuth),w.basePath,"./package.json");let h;console.log("environment: dev"),h=process.env.IS_OFFLINE?new c.CoreApp(v,p,new c.FileStorageAdapter("db.json"),y,w):new c.CoreApp(v,p,new c.S3StorageAdapter(w.s3Bucket,w.s3File),y,w);const A=(async()=>new Promise(async(e,n)=>{await h.setup(),e()}))(),S=async(e,n)=>(await A,await d(e,n))},function(e,n){e.exports=require("cognito-express")}]));